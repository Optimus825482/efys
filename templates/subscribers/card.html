{% extends 'base.html' %} {% block title %}Abone Kartı{% endblock %} {% block
page_title %}Abone Kartı{% endblock %} {% set breadcrumb = [{'name':
'Aboneler', 'url': url_for('subscribers.index')}, {'name': 'Abone Kartı'}] %}
{% block content %}
<div class="card mb-4">
    <div class="card-header"
        style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;">
        <h3 class="card-title">Abone Seçimi</h3>
        <div style="display:flex;gap:12px;align-items:center;">
            <select id="subscriberSelect" class="form-select" style="min-width:320px;">
                <option value="">Abone seçiniz...</option>
                {% for s in subscribers %}
                <option value="{{ url_for('subscribers.card', id=s.id) }}" {{ 'selected' if subscriber and
                    s.id==subscriber.id else '' }}>
                    {{ s.subscriber_no or s.subscriber_code }} - {{ s.name }}
                </option>
                {% endfor %}
            </select>
            {% if subscriber %}
            <a href="{{ url_for('subscribers.detail', id=subscriber.id) }}" class="btn btn-secondary">Detay Sayfası</a>
            {% endif %}
        </div>
    </div>
</div>

{% if not subscriber %}
<div class="card">
    <div class="card-body" style="text-align:center;padding:32px;">
        Lütfen bir abone seçiniz.
    </div>
</div>
{% else %}
<div class="grid grid-cols-3 gap-4">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Abone Bilgileri</h3>
        </div>
        <div class="card-body">
            <div class="detail-row">
                <div class="label">Abone Kodu</div>
                <div class="value">{{ subscriber.subscriber_code }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Unvan</div>
                <div class="value">{{ subscriber.name }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Sektör</div>
                <div class="value">{{ subscriber.sector or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Abone Tipi</div>
                <div class="value">{{ subscriber.subscriber_type or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Tarife</div>
                <div class="value">{{ subscriber.tariff_name or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Durum</div>
                <div class="value">{{ subscriber.status }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Sözleşme Gücü</div>
                <div class="value">{{ subscriber.contract_demand or '-' }} kW</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Vergi & Adres</h3>
        </div>
        <div class="card-body">
            <div class="detail-row">
                <div class="label">Vergi No</div>
                <div class="value">{{ subscriber.tax_no or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Vergi Dairesi</div>
                <div class="value">{{ subscriber.tax_office or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Adres</div>
                <div class="value">{{ subscriber.address or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Ada / Parsel</div>
                <div class="value">{{ subscriber.ada or '-' }} / {{ subscriber.parsel or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Alan</div>
                <div class="value">{{ subscriber.area_m2 or '-' }} m²</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">İletişim</h3>
        </div>
        <div class="card-body">
            <div class="detail-row">
                <div class="label">Telefon</div>
                <div class="value">{{ subscriber.phone or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">E-posta</div>
                <div class="value">{{ subscriber.email or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Kayıt Tarihi</div>
                <div class="value">{{ subscriber.created_at or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Güncelleme</div>
                <div class="value">{{ subscriber.updated_at or '-' }}</div>
            </div>
        </div>
    </div>
</div>

<div class="grid grid-cols-3 gap-4 mt-4">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Sayaç Bilgileri</h3>
        </div>
        <div class="card-body">
            <div class="detail-row">
                <div class="label">Sayaç No</div>
                <div class="value">{{ subscriber.meter_no or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Marka</div>
                <div class="value">{{ subscriber.meter_brand or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Model</div>
                <div class="value">{{ subscriber.meter_model or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Durum</div>
                <div class="value">{{ subscriber.meter_status or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Son Okuma</div>
                <div class="value">{{ subscriber.last_reading_at or '-' }}</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Tüketim Özeti</h3>
        </div>
        <div class="card-body">
            <div class="detail-row">
                <div class="label">Ort. Günlük Tüketim</div>
                <div class="value">{{ subscriber.avg_daily_consumption_kwh or '-' }} kWh</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Sözleşme & Tarifeler</h3>
        </div>
        <div class="card-body">
            <div class="detail-row">
                <div class="label">Tarife</div>
                <div class="value">{{ subscriber.tariff_name or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Sözleşme Gücü</div>
                <div class="value">{{ subscriber.contract_demand or '-' }} kW</div>
            </div>
            <div class="detail-row">
                <div class="label">Abone Tipi</div>
                <div class="value">{{ subscriber.subscriber_type or '-' }}</div>
            </div>
            <div class="detail-row">
                <div class="label">Durum</div>
                <div class="value">{{ subscriber.status }}</div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
    .detail-row {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        padding: 8px 0;
        border-bottom: 1px dashed var(--color-border);
    }

    .detail-row:last-child {
        border-bottom: 0;
    }

    .detail-row .label {
        color: var(--color-text-secondary);
        font-size: 0.8rem;
    }

    .detail-row .value {
        font-weight: 600;
        color: var(--color-text-primary);
        text-align: right;
    }
</style>

<script>
    const selectEl = document.getElementById( 'subscriberSelect' );
    if ( selectEl ) {
        selectEl.addEventListener( 'change', ( e ) => {
            const url = e.target.value;
            if ( url ) window.location.href = url;
        } );
    }
</script>
{% endblock %}