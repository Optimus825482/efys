{% extends 'base.html' %} {% block title %}Sistem Logları{% endblock %} {% block
page_title %}Sistem Logları{% endblock %} {% set breadcrumb = [{'name':
'Ayarlar', 'url': url_for('settings.index')}, {'name': 'Loglar'}] %} {% block
content %}
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Son İşlemler ({{ logs|length }} kayıt)</h3>
    <div style="display: flex; gap: 8px">
      <select class="form-select" style="width: auto" id="logLevelFilter">
        <option value="">Tümü</option>
        <option value="ERROR">Hata</option>
        <option value="WARNING">Uyarı</option>
        <option value="INFO">Bilgi</option>
        <option value="DEBUG">Debug</option>
      </select>
      <select class="form-select" style="width: auto" id="moduleFilter">
        <option value="">Tüm Modüller</option>
        {% set modules = logs|map(attribute='module')|unique|list %}
        {% for module in modules %}
        <option value="{{ module }}">{{ module }}</option>
        {% endfor %}
      </select>
      <button class="btn btn-secondary btn-sm" onclick="filterLogs()">Filtrele</button>
      <button class="btn btn-outline-secondary btn-sm" onclick="window.location.reload()">
        <i class="fas fa-sync"></i> Yenile
      </button>
    </div>
  </div>
  <div class="card-body" style="padding: 0">
    <table class="table" id="logsTable">
      <thead>
        <tr>
          <th style="width: 160px">Zaman</th>
          <th style="width: 80px">Seviye</th>
          <th style="width: 120px">Modül</th>
          <th>Mesaj</th>
        </tr>
      </thead>
      <tbody>
        {% if logs %}
        {% for log in logs %}
        <tr data-level="{{ log.log_level }}" data-module="{{ log.module }}">
          <td style="font-size: 0.875rem">{{ log.created_at.strftime('%d.%m.%Y %H:%M:%S') if log.created_at else '-' }}
          </td>
          <td>
            {% if log.log_level == 'ERROR' %}
            <span class="badge badge-danger">ERROR</span>
            {% elif log.log_level == 'WARNING' %}
            <span class="badge badge-warning">WARN</span>
            {% elif log.log_level == 'INFO' %}
            <span class="badge badge-success">INFO</span>
            {% elif log.log_level == 'DEBUG' %}
            <span class="badge badge-secondary">DEBUG</span>
            {% else %}
            <span class="badge badge-primary">{{ log.log_level }}</span>
            {% endif %}
          </td>
          <td>{{ log.module or '-' }}</td>
          <td style="font-size: 0.875rem">{{ log.message }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <tr id="noLogsRow">
          <td colspan="4" style="text-align: center; padding: 40px; color: #6b7280">
            <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 8px; display: block"></i>
            Henüz log kaydı bulunmuyor
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<script>
  function filterLogs() {
    const levelFilter = document.getElementById( 'logLevelFilter' ).value;
    const moduleFilter = document.getElementById( 'moduleFilter' ).value;
    const rows = document.querySelectorAll( '#logsTable tbody tr[data-level]' );

    let visibleCount = 0;
    rows.forEach( row => {
      const level = row.dataset.level;
      const module = row.dataset.module;

      const levelMatch = !levelFilter || level === levelFilter;
      const moduleMatch = !moduleFilter || module === moduleFilter;

      if ( levelMatch && moduleMatch ) {
        row.style.display = '';
        visibleCount++;
      } else {
        row.style.display = 'none';
      }
    } );

    // Kayıt sayısını güncelle
    const title = document.querySelector( '.card-title' );
    title.textContent = `Son İşlemler (${visibleCount} kayıt)`;
  }
</script>
{% endblock %}