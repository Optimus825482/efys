{% extends 'base.html' %}
{% block title %}ERP Entegrasyonu{% endblock %}
{% block page_title %}ERP KÃ¶prÃ¼sÃ¼{% endblock %}
{% set breadcrumb = [{'name': 'AkÄ±llÄ± Sistemler', 'url': url_for('smart.index')}, {'name': 'ERP KÃ¶prÃ¼sÃ¼'}] %}
{% block content %}
<div class="grid grid-cols-4 gap-4 mb-4">
    <div class="kpi-card">
        <div class="kpi-card-value" style="color: var(--color-success)">â— BaÄŸlÄ±</div>
        <div class="kpi-card-label">ERP Durumu</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-card-value">1,247</div>
        <div class="kpi-card-label">Senkronize KayÄ±t</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-card-value">5 dk</div>
        <div class="kpi-card-label">Son Senkronizasyon</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-card-value">99.8%</div>
        <div class="kpi-card-label">Uptime</div>
    </div>
</div>

<div class="grid grid-cols-2 gap-4 mb-4">
    <!-- Entegrasyon AyarlarÄ± -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">âš™ï¸ Entegrasyon AyarlarÄ±</h3>
        </div>
        <div class="card-body">
            <div style="margin-bottom: 20px;">
                <label class="form-label">ERP Sistemi</label>
                <select class="form-select">
                    <option selected>SAP Business One</option>
                    <option>Microsoft Dynamics</option>
                    <option>Oracle NetSuite</option>
                    <option>Logo Tiger</option>
                    <option>Netsis</option>
                </select>
            </div>
            <div style="margin-bottom: 20px;">
                <label class="form-label">API Endpoint</label>
                <input type="text" class="form-control" value="https://erp.gonenobs.com/api/v2" readonly>
            </div>
            <div style="margin-bottom: 20px;">
                <label class="form-label">Senkronizasyon SÄ±klÄ±ÄŸÄ±</label>
                <select class="form-select">
                    <option>Her 5 dakika</option>
                    <option selected>Her 15 dakika</option>
                    <option>Her saat</option>
                    <option>GÃ¼nlÃ¼k</option>
                </select>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-primary">AyarlarÄ± Kaydet</button>
                <button class="btn btn-outline-primary">BaÄŸlantÄ±yÄ± Test Et</button>
            </div>
        </div>
    </div>

    <!-- Veri AkÄ±ÅŸÄ± -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">ğŸ”„ Veri AkÄ±ÅŸ ÅemasÄ±</h3>
        </div>
        <div class="card-body">
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div
                        style="width: 100px; text-align: center; padding: 12px; background: var(--color-primary-100); border-radius: var(--radius-md);">
                        <div style="font-weight: 600; color: var(--color-primary);">EFYS</div>
                    </div>
                    <div style="flex: 1; height: 2px; background: var(--color-primary); position: relative;">
                        <div
                            style="position: absolute; right: 0; top: -4px; border: solid var(--color-primary); border-width: 0 2px 2px 0; padding: 4px; transform: rotate(-45deg);">
                        </div>
                    </div>
                    <div
                        style="width: 100px; text-align: center; padding: 12px; background: var(--color-success-bg); border-radius: var(--radius-md);">
                        <div style="font-weight: 600; color: var(--color-success);">ERP</div>
                    </div>
                </div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary); padding-left: 116px;">
                    â€¢ Fatura verileri<br>
                    â€¢ Abone bilgileri<br>
                    â€¢ Ã–deme kayÄ±tlarÄ±
                </div>
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div
                        style="width: 100px; text-align: center; padding: 12px; background: var(--color-success-bg); border-radius: var(--radius-md);">
                        <div style="font-weight: 600; color: var(--color-success);">ERP</div>
                    </div>
                    <div style="flex: 1; height: 2px; background: var(--color-success); position: relative;">
                        <div
                            style="position: absolute; right: 0; top: -4px; border: solid var(--color-success); border-width: 0 2px 2px 0; padding: 4px; transform: rotate(-45deg);">
                        </div>
                    </div>
                    <div
                        style="width: 100px; text-align: center; padding: 12px; background: var(--color-primary-100); border-radius: var(--radius-md);">
                        <div style="font-weight: 600; color: var(--color-primary);">EFYS</div>
                    </div>
                </div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary); padding-left: 116px;">
                    â€¢ Tahsilat bildirimleri<br>
                    â€¢ Cari hesap mutabakatÄ±
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Senkronizasyon LoglarÄ± -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">ğŸ“‹ Senkronizasyon LoglarÄ±</h3>
    </div>
    <div class="card-body">
        <div id="logsGrid" style="height: 350px;" class="ag-theme-alpine"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    var gridOptions = {
        columnDefs: [
            { field: 'timestamp', headerName: 'Zaman', width: 180 },
            {
                field: 'direction', headerName: 'YÃ¶n', width: 120,
                cellRenderer: params => params.value === 'EFYS â†’ ERP' ?
                    '<span style="color: #3B82F6;">â†— EFYS â†’ ERP</span>' :
                    '<span style="color: #10B981;">â†™ ERP â†’ EFYS</span>'
            },
            { field: 'type', headerName: 'Veri Tipi', width: 150 },
            { field: 'records', headerName: 'KayÄ±t SayÄ±sÄ±', width: 120, type: 'numericColumn' },
            {
                field: 'status', headerName: 'Durum', width: 120,
                cellRenderer: params => {
                    var colors = { 'BaÅŸarÄ±lÄ±': '#10B981', 'Hata': '#EF4444', 'Beklemede': '#F59E0B' };
                    return `<span style="color: ${colors[params.value]}; font-weight: bold;">â— ${params.value}</span>`;
                }
            },
            { field: 'message', headerName: 'Mesaj', flex: 1 }
        ],
        rowData: [
            { timestamp: '29.01.2026 10:45:23', direction: 'EFYS â†’ ERP', type: 'Fatura', records: 5, status: 'BaÅŸarÄ±lÄ±', message: '5 fatura ERP sistemine aktarÄ±ldÄ±' },
            { timestamp: '29.01.2026 10:30:15', direction: 'ERP â†’ EFYS', type: 'Ã–deme', records: 3, status: 'BaÅŸarÄ±lÄ±', message: '3 Ã¶deme kaydÄ± gÃ¼ncellendi' },
            { timestamp: '29.01.2026 10:15:08', direction: 'EFYS â†’ ERP', type: 'Abone', records: 1, status: 'BaÅŸarÄ±lÄ±', message: 'Yeni abone kaydÄ± oluÅŸturuldu' },
            { timestamp: '29.01.2026 10:00:00', direction: 'EFYS â†’ ERP', type: 'Fatura', records: 12, status: 'BaÅŸarÄ±lÄ±', message: 'Toplu fatura aktarÄ±mÄ± tamamlandÄ±' },
            { timestamp: '29.01.2026 09:45:30', direction: 'ERP â†’ EFYS', type: 'Cari', records: 30, status: 'BaÅŸarÄ±lÄ±', message: 'Cari hesap bakiyeleri senkronize edildi' }
        ],
        defaultColDef: { sortable: true, filter: true, resizable: true },
        localeText: AG_GRID_LOCALE_TR
    };

    agGrid.createGrid( document.getElementById( 'logsGrid' ), gridOptions );
</script>
{% endblock %}